{% extends 'base.html' %}

{% block title %}{{ _('Galerie') }}{% endblock %}

{% block content %}
<div class="header">
    <select id="group-select" class="user-string-horizontal grid-sizer">
        <option value="_all" {{ 'selected=selected' if not selected_group else '' }}>
            {% if all_unread_count != 0 %}
            ({{ all_unread_count|format_count }})
            {% endif %}
            {{ _('all') }}
        </option>
        <optgroup label="{{ _('by groups') }}">
            {% for g in groups %}
            <option value="group-{{ g.gid }}" {{ 'selected=selected' if selected_group and g.gid == selected_group.gid else '' }}>
                {% if all_group_counts[g.gid] != 0 %}
                ({{ all_group_counts[g.gid]|format_count }})
                {% endif %}
                {{ g.title }}
            </option>
            {% endfor %}
        </optgroup>
        <option value="_history">{{ _('history') }}</option>
        <optgroup label="{{ _('by feed') }}">
            {% for f in feeds %}
            <option value="feed-{{ f.fid }}">
                {{ f.title }}
            </option>
            {% endfor %}
        </optgroup>
    </select>
    <!-- hack to ensure height is consistent... -->
    <p style="visibility: hidden;">.</p>
    <div class="header-right grid-sizer">
        <p id="read-percentage">{{ read_percentage }}%</p>
        <a
            id="refresh-button"
            href="javascript:window.location.reload();"
            class="link-button"
        >üîÑ</a>
        <a
            href="javascript:void(0)"
            hx-confirm="{{ _('Are you sure you want to mark this group as read?') }}"
            hx-post="/actions/mark_as_read?group={{ gid }}&sort={{ sort }}"
            hx-disabled-elt="this"
            class="link-button"
        >‚úÖ</a>
        <a
            href="javascript:document.getElementById('settings').showModal()"
            class="link-button"
        >‚öôÔ∏è</a>
        <dialog id="settings">
            <p>
                {{ _('Status') }} 
                <select id="read-select">
                    <option value="0" {{ 'selected=selected' if include_read == '0' else '' }}>{{ _('unread only') }}</option>
                    <option value="1" {{ 'selected=selected' if include_read == '1' else '' }}>{{ _('include read') }}</option>
                </select>
            </p>
            <p>
                {{ _('Sort') }}
                <select id="sort-select">
                    <option value="0" {{ 'selected=selected' if sort_by_desc else '' }}>{{ _('descending') }}</option>
                    <option value="1" {{ 'selected=selected' if not sort_by_desc else '' }}>{{ _('ascending') }}</option>
                </select>
            </p>
            <p>
                {{ _('No text mode') }} 
                <select
                    name="no_text_mode"
                    hx-trigger="change"
                    hx-post="/actions/set_no_text_mode"
                    hx-swap="none"
                >
                    <option value="0" {{ 'selected=selected' if not no_text_mode else '' }}>{{ _('no') }}</option>
                    <option value="1" {{ 'selected=selected' if no_text_mode else '' }}>{{ _('yes') }}</option>
                </select>
            </p>
            <a href="/settings">
                <button class="button" style="font-size: 1em">{{ _('More settings') }}</button>
            </a>
            <br>
            <br>
            <button class="button" onclick="document.getElementById('settings').close()">
                {{ _('Close') }}
            </button>
        </dialog>
    </div>
</div>
{% if not has_24h_items and not has_24_48h_items and not has_beyond_48h_items %}
<div class="all-read">
    {% if all_feed_count == 0%}
    <a href="/add_feed?go_home=1" style="font-size: 1em;">
        <p class="animate-long">{{ _('start adding some feeds ‚ù§Ô∏è') }}</p>
    </a>
    {% elif all_unread_count == 0 %}
    <p>{{ _('all read ‚ú®') }}</p>
    <p>{{ _('go touch some grass üå±') }}</p>
    {% else %}
    {% for g in groups %}
    {% if all_group_counts[g.gid] != 0 %}
    <a href="/?group={{ g.gid }}">
        <button class="button" style="font-size: 1em">
            {{ g.title }} {{ _('has') }} {{ all_group_counts[g.gid]|format_count }} {{ _('unread items') }}
        </button>
    </a>
    <br>
    <br>
    {% endif %}
    {% endfor %}
    {% endif %}
</div>
{% endif %}

{# Section 1: Past 24 hours #}
{% if has_24h_items %}
<h2 style="margin: 1em 0 0.5em 0; padding: 0;">{{ _('Past 24 hours') }}</h2>
<div class="grid" id="grid-24h">
    <div class="grid-sizer"></div>
    {% with items=section_24h.items, should_show_feed_title=section_24h.should_show_feed_title, should_show_feed_group=section_24h.should_show_feed_group, rendered_feed_icons=section_24h.rendered_feed_icons, no_text_mode=section_24h.no_text_mode %}
    {% include 'items_stream.html' %}
    {% endwith %}
</div>
{% if last_iid_24h %}
{% with from_iid=section_24h.from_iid, gid=section_24h.gid, sort=section_24h.sort, remaining_count=section_24h.remaining_count, include_read=section_24h.include_read, total_count=section_24h.total_count, after=section_24h.after, before=section_24h.before, infinite_scroll=section_24h.infinite_scroll, section_id='24h' %}
{% include 'load_more_button.html' %}
{% endwith %}
{% endif %}
{% endif %}

{# Section 2: 24-48 hours #}
{% if has_24_48h_items %}
<h2 style="margin: 1em 0 0.5em 0; padding: 0;">{{ _('24-48 hours ago') }}</h2>
<div class="grid" id="grid-24-48h">
    <div class="grid-sizer"></div>
    {% with items=section_24_48h.items, should_show_feed_title=section_24_48h.should_show_feed_title, should_show_feed_group=section_24_48h.should_show_feed_group, rendered_feed_icons=section_24_48h.rendered_feed_icons, no_text_mode=section_24_48h.no_text_mode %}
    {% include 'items_stream.html' %}
    {% endwith %}
</div>
{% if last_iid_24_48h %}
{% with from_iid=section_24_48h.from_iid, gid=section_24_48h.gid, sort=section_24_48h.sort, remaining_count=section_24_48h.remaining_count, include_read=section_24_48h.include_read, total_count=section_24_48h.total_count, after=section_24_48h.after, before=section_24_48h.before, infinite_scroll=section_24_48h.infinite_scroll, section_id='24-48h' %}
{% include 'load_more_button.html' %}
{% endwith %}
{% endif %}
{% endif %}

{# Section 3: Beyond 48 hours #}
{% if has_beyond_48h_items %}
<h2 style="margin: 1em 0 0.5em 0; padding: 0;">{{ _('Beyond 48 hours') }}</h2>
<div class="grid" id="grid-beyond-48h">
    <div class="grid-sizer"></div>
    {% with items=section_beyond_48h.items, should_show_feed_title=section_beyond_48h.should_show_feed_title, should_show_feed_group=section_beyond_48h.should_show_feed_group, rendered_feed_icons=section_beyond_48h.rendered_feed_icons, no_text_mode=section_beyond_48h.no_text_mode %}
    {% include 'items_stream.html' %}
    {% endwith %}
</div>
{% if last_iid_beyond_48h %}
{% with from_iid=section_beyond_48h.from_iid, gid=section_beyond_48h.gid, sort=section_beyond_48h.sort, remaining_count=section_beyond_48h.remaining_count, include_read=section_beyond_48h.include_read, total_count=section_beyond_48h.total_count, after=section_beyond_48h.after, before=section_beyond_48h.before, infinite_scroll=section_beyond_48h.infinite_scroll, section_id='beyond-48h' %}
{% include 'load_more_button.html' %}
{% endwith %}
{% endif %}
{% endif %}
<script src="{{ static_url_for('static', filename='grid.js') }}"></script>
<script src="{{ static_url_for('static', filename='index.js') }}"></script>
{% endblock %}

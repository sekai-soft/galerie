<!--
    Infinite scroll load more button.

    - intersect: fires when element enters viewport, including on OOB swap insertion.
      Unlike 'revealed', it fires even if element is already visible when added to DOM.
      https://htmx.org/attributes/hx-trigger/ (search "intersect")

    - hx-sync="#grid:drop": prevents duplicate requests by syncing on #grid (which
      persists across OOB swaps). If a request is in flight, new ones are dropped.
      https://htmx.org/attributes/hx-sync/
-->
<div
    class="button-container"
    id="buttons"
    hx-swap-oob="true"
>
    <button
        class="button"
        hx-post="/actions/load_more?from_iid={{ from_iid }}&group={{ gid }}&sort={{ sort }}&remaining_count={{ remaining_count }}&read={{ include_read }}&total_count={{ total_count }}"
        {% if scroll_as_read %}
        hx-include="#grid .iid"
        hx-on:htmx:before-send="document.querySelectorAll('#grid .iid').forEach(el => el.remove())"
        {% endif %}
        hx-trigger="{{ 'intersect' if infinite_scroll else 'click' }}"
        hx-sync="#grid:drop"
        hx-target="#grid"
        hx-swap="beforeend"
        hx-disabled-elt="this"
    >
    {% if remaining_count > 0 %}
        {{ _('Load') }} {{ remaining_count }} {{ _('more') }} <span class="htmx-indicator">...</span>
    {% else %}
        {{ _('Load') }} {{ _('more') }} <span class="htmx-indicator">...</span>
    {% endif %}
    </button>
</div>
